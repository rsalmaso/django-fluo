(function($){$.fn.formset=function(opts){var options=$.extend({},$.fn.formset.defaults,opts);var $this=$(this);var $parent=$this.parent();var updateElementIndex=function(el,prefix,ndx){var id_regex=new RegExp("("+prefix+"-(\\d+|__prefix__))");var replacement=prefix+"-"+ndx;if($(el).attr("for")){$(el).attr("for",$(el).attr("for").replace(id_regex,replacement));}
if(el.id){el.id=el.id.replace(id_regex,replacement);}
if(el.name){el.name=el.name.replace(id_regex,replacement);}};var nextIndex=get_no_forms(options.prefix);$this.each(function(i){$(this).not("."+options.emptyCssClass).addClass(options.formCssClass);});var showAddButton=get_max_forms(options.prefix)===''||(get_max_forms(options.prefix)-get_no_forms(options.prefix))>0;if($this.length&&showAddButton){var addButton;var numCols=this.eq(-1).children().length;var addButtonHTML='<tr class="'+options.addCssClass+'"><td colspan="'+numCols+'"><a href="javascript:void(0)">'+options.addText+"</a></tr>";if($this.attr("tagName")=="TR"){$parent.append(addButtonHTML);addButton=$parent.find("tr:last a");}else{$this.filter(":last").after(addButtonHTML);addButton=$this.filter(":last").next().find("a");}
addButton.click(function(e){e.preventDefault();var nextIndex=get_no_forms(options.prefix);var template=$("#"+options.prefix+"-empty");var row=template.clone(true);row.removeClass(options.emptyCssClass).addClass(options.formCssClass).attr("id",options.prefix+"-"+nextIndex);if(row.is("tr")){row.children(":last").append('<div><a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+"</a></div>");}else if(row.is("ul")||row.is("ol")){row.append('<li><a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+"</a></li>");}else{row.children(":first").append('<span><a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+"</a></span>");}
row.find("*").each(function(){updateElementIndex(this,options.prefix,nextIndex);});row.insertBefore($(template));change_no_forms(options.prefix,true);if((get_max_forms(options.prefix)!=='')&&(get_max_forms(options.prefix)-get_no_forms(options.prefix))<=0){addButton.parent().hide();}
row.find("a."+options.deleteCssClass).click(function(e){e.preventDefault();var row=$(this).parents("."+options.formCssClass);var formset_to_update=row.parent();while(row.next().hasClass('nested-inline-row')){row.next().remove();}
row.remove();change_no_forms(options.prefix,false);if(options.removed){options.removed(formset_to_update);}});if(row.is("tr")){nested_formsets=create_nested_formset(options.prefix,nextIndex,options,false);if(nested_formsets.length){row.addClass("no-bottom-border");}
nested_formsets.each(function(){if(!$(this).next()){border_class="";}else{border_class=" no-bottom-border";}
($('<tr class="nested-inline-row'+border_class+'">').html(($('<td>',{colspan:'100%'}).html($(this))))).insertBefore($(template));});}else{nested_formsets=create_nested_formset(options.prefix,nextIndex,options,true);nested_formsets.each(function(){row.append($(this));});}
if(options.added){options.added(row);}
nextIndex=nextIndex+1;});}
return this;};$.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};$.fn.tabularFormset=function(options){var $rows=$(this);var alternatingRows=function(row){row_number=0;$($rows.selector).not(".add-row").removeClass("row1 row2").each(function(){$(this).addClass('row'+((row_number%2)+1));next=$(this).next();while(next.hasClass('nested-inline-row')){next.addClass('row'+((row_number%2)+1));next=next.next();}
row_number=row_number+1;});};var reinitDateTimeShortCuts=function(){if(typeof DateTimeShortcuts!="undefined"){$(".datetimeshortcuts").remove();DateTimeShortcuts.init();}};var updateSelectFilter=function(){if(typeof SelectFilter!='undefined'){$('.selectfilter').each(function(index,value){var namearr=value.name.split('-');SelectFilter.init(value.id,namearr[namearr.length-1],false,options.adminStaticPrefix);});$('.selectfilterstacked').each(function(index,value){var namearr=value.name.split('-');SelectFilter.init(value.id,namearr[namearr.length-1],true,options.adminStaticPrefix);});}};var initPrepopulatedFields=function(row){row.find('.prepopulated_field').each(function(){var field=$(this),input=field.find('input, select, textarea'),dependency_list=input.data('dependency_list')||[],dependencies=[];$.each(dependency_list,function(i,field_name){dependencies.push('#'+row.find('.field-'+field_name).find('input, select, textarea').attr('id'));});if(dependencies.length){input.prepopulate(dependencies,input.attr('maxlength'));}});};$rows.formset({prefix:options.prefix,addText:options.addText,formCssClass:"dynamic-"+options.prefix,deleteCssClass:"inline-deletelink",deleteText:options.deleteText,emptyCssClass:"empty-form",removed:alternatingRows,added:function(row){initPrepopulatedFields(row);reinitDateTimeShortCuts();updateSelectFilter();alternatingRows(row);}});return $rows;};$.fn.stackedFormset=function(options){var $rows=$(this);var update_inline_labels=function(formset_to_update){formset_to_update.children('.inline-related').not('.empty-form').children('h3').find('.inline_label').each(function(i){var count=i+1;$(this).html($(this).html().replace(/(#\d+)/g,"#"+count));});};var reinitDateTimeShortCuts=function(){if(typeof DateTimeShortcuts!="undefined"){$(".datetimeshortcuts").remove();DateTimeShortcuts.init();}};var updateSelectFilter=function(){if(typeof SelectFilter!="undefined"){$(".selectfilter").each(function(index,value){var namearr=value.name.split('-');SelectFilter.init(value.id,namearr[namearr.length-1],false,options.adminStaticPrefix);});$(".selectfilterstacked").each(function(index,value){var namearr=value.name.split('-');SelectFilter.init(value.id,namearr[namearr.length-1],true,options.adminStaticPrefix);});}};var initPrepopulatedFields=function(row){row.find('.prepopulated_field').each(function(){var field=$(this),input=field.find('input, select, textarea'),dependency_list=input.data('dependency_list')||[],dependencies=[];$.each(dependency_list,function(i,field_name){dependencies.push('#'+row.find('.form-row .field-'+field_name).find('input, select, textarea').attr('id'));});if(dependencies.length){input.prepopulate(dependencies,input.attr('maxlength'));}});};$rows.formset({prefix:options.prefix,addText:options.addText,formCssClass:"dynamic-"+options.prefix,deleteCssClass:"inline-deletelink",deleteText:options.deleteText,emptyCssClass:"empty-form",removed:update_inline_labels,added:(function(row){initPrepopulatedFields(row);reinitDateTimeShortCuts();updateSelectFilter();update_inline_labels(row.parent());})});return $rows;};function create_nested_formset(parent_formset_prefix,next_form_id,options,add_bottom_border){var formsets=$(false);var normalized_parent_formset_prefix=parent_formset_prefix.replace(/[-][0-9][-]/g,"-0-");var nested_inlines=$('#'+normalized_parent_formset_prefix+"-group ."+normalized_parent_formset_prefix+"-0-nested-inline").not('.cloned');if(!nested_inlines.length){nested_inlines=$('#'+normalized_parent_formset_prefix+"-group ."+normalized_parent_formset_prefix+"-nested-inline").not('.cloned');}
nested_inlines.each(function(key,formsetToClone){var normalized_formset_prefix=$(this).attr('id').split('-group')[0];var formset_prefix=normalized_formset_prefix.replace(normalized_parent_formset_prefix+"-0",parent_formset_prefix+"-"+next_form_id);var template=$(formsetToClone).clone();template.addClass('cloned');if(template.children().first().hasClass('tabular')){template.find(".form-row").not(".empty-form").remove();template.find(".nested-inline-row").remove();template_form=template.find("#"+normalized_formset_prefix+"-empty")
new_form=template_form.clone().removeClass(options.emptyCssClass).addClass("dynamic-"+formset_prefix);new_form.insertBefore(template_form);var inputs=new_form.find('input');inputs.each(function(){var $input=$(this)
if($input.val()){$input.removeAttr('value')}});update_props(template,normalized_formset_prefix,formset_prefix);template.find('#id_'+formset_prefix+'-TOTAL_FORMS').val(1);template.find('#id_'+formset_prefix+'-INITIAL_FORMS').val(0);var add_text=template.find('.add-row').text();template.find('.add-row').remove();template.find('.tabular.inline-related tbody tr.'+formset_prefix+'-not-nested').tabularFormset({prefix:formset_prefix,adminStaticPrefix:options.adminStaticPrefix,addText:add_text,deleteText:options.deleteText});var nested_formsets=create_nested_formset(formset_prefix,0,options,false);if(nested_formsets.length){template.find(".form-row").addClass('no-bottom-border');}
nested_formsets.each(function(){if(!$(this).next()){border_class="";}else{border_class=" no-bottom-border";}
template.find("#"+formset_prefix+"-empty").before(($('<tr class="nested-inline-row'+border_class+'">').html(($('<td>',{colspan:'100%'}).html($(this))))));});}else{var nested_formsets=create_nested_formset(formset_prefix,0,options,true);template.find(".inline-related").not(".empty-form").remove();template_form=template.find("#"+normalized_formset_prefix+"-empty")
new_form=template_form.clone().removeClass(options.emptyCssClass).addClass("dynamic-"+formset_prefix);new_form.insertBefore(template_form);var inputs=new_form.find('input');inputs.each(function(){var $input=$(this)
if($input.val()){$input.removeAttr('value')}});new_form.find('.inline_label').text('#1');update_props(template,normalized_formset_prefix,formset_prefix);template.find('#id_'+formset_prefix+'-TOTAL_FORMS').val(1);template.find('#id_'+formset_prefix+'-INITIAL_FORMS').val(0);var add_text=template.find('.add-row').text();template.find('.add-row').remove();template.find(".inline-related").stackedFormset({prefix:formset_prefix,adminStaticPrefix:options.adminStaticPrefix,addText:add_text,deleteText:options.deleteText});nested_formsets.each(function(){new_form.append($(this));});}
if(add_bottom_border){template=template.add($('<div class="nested-inline-bottom-border">'));}
if(formsets.length){formsets=formsets.add(template);}else{formsets=template;}});return formsets;};function update_props(template,normalized_formset_prefix,formset_prefix){template.attr('id',template.attr('id').replace(normalized_formset_prefix,formset_prefix));template.find('*').each(function(){if($(this).attr("for")){$(this).attr("for",$(this).attr("for").replace(normalized_formset_prefix,formset_prefix));}
if($(this).attr("class")){$(this).attr("class",$(this).attr("class").replace(normalized_formset_prefix,formset_prefix));}
if(this.id){this.id=this.id.replace(normalized_formset_prefix,formset_prefix);}
if(this.name){this.name=this.name.replace(normalized_formset_prefix,formset_prefix);}});prefix_fix=template.find(".inline-related").first();nextIndex=get_no_forms(formset_prefix);if(prefix_fix.hasClass('tabular')){prefix_fix=prefix_fix.find('.form-row').first();prefix_fix.attr('id',prefix_fix.attr('id').replace('-empty','-'+nextIndex));}else{prefix_fix.attr('id',prefix_fix.attr('id').replace('-empty','-'+nextIndex));}
prefix_fix.find('*').each(function(){if($(this).attr("for")){$(this).attr("for",$(this).attr("for").replace('__prefix__','0'));}
if($(this).attr("class")){$(this).attr("class",$(this).attr("class").replace('__prefix__','0'));}
if(this.id){this.id=this.id.replace('__prefix__','0');}
if(this.name){this.name=this.name.replace('__prefix__','0');}});};function get_no_forms(formset_prefix){formset_prop=$("#id_"+formset_prefix+"-TOTAL_FORMS")
if(!formset_prop.length){return 0;}
return parseInt(formset_prop.attr("autocomplete","off").val());}
function change_no_forms(formset_prefix,increase){var no_forms=get_no_forms(formset_prefix);if(increase){$("#id_"+formset_prefix+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(no_forms)+1);}else{$("#id_"+formset_prefix+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(no_forms)-1);}};function get_max_forms(formset_prefix){var max_forms=$("#id_"+formset_prefix+"-MAX_NUM_FORMS").attr("autocomplete","off").val();if(typeof max_forms=='undefined'){return'';}
return parseInt(max_forms);};})(django.jQuery);
